import logging
from optparse import Values
from typing import List

from pip._internal.cli.base_command import Command
from pip._internal.cli.status_codes import ERROR, SUCCESS
from pip._internal.operations.check import (
    check_package_set,
    create_package_set_from_installed,
<<<<<<< HEAD
<<<<<<< HEAD
    warn_legacy_versions_and_specifiers,
=======
>>>>>>> df325ab2fd198d525717375d770d9aa54a62e81d
=======
=======
    warn_legacy_versions_and_specifiers,
>>>>>>> 69cfeeef2f976b4d42eb26221f042bd52a00e559
>>>>>>> b7b1c37ba3a9c0a368c733e0bda45eee6e08b936
)
from pip._internal.utils.misc import write_output

logger = logging.getLogger(__name__)


class CheckCommand(Command):
    """Verify installed packages have compatible dependencies."""

    usage = """
      %prog [options]"""

    def run(self, options: Values, args: List[str]) -> int:
<<<<<<< HEAD
<<<<<<< HEAD
        package_set, parsing_probs = create_package_set_from_installed()
        warn_legacy_versions_and_specifiers(package_set)
=======

        package_set, parsing_probs = create_package_set_from_installed()
>>>>>>> df325ab2fd198d525717375d770d9aa54a62e81d
=======

        package_set, parsing_probs = create_package_set_from_installed()
=======
        package_set, parsing_probs = create_package_set_from_installed()
        warn_legacy_versions_and_specifiers(package_set)
>>>>>>> 69cfeeef2f976b4d42eb26221f042bd52a00e559
>>>>>>> b7b1c37ba3a9c0a368c733e0bda45eee6e08b936
        missing, conflicting = check_package_set(package_set)

        for project_name in missing:
            version = package_set[project_name].version
            for dependency in missing[project_name]:
                write_output(
                    "%s %s requires %s, which is not installed.",
                    project_name,
                    version,
                    dependency[0],
                )

        for project_name in conflicting:
            version = package_set[project_name].version
            for dep_name, dep_version, req in conflicting[project_name]:
                write_output(
                    "%s %s has requirement %s, but you have %s %s.",
                    project_name,
                    version,
                    req,
                    dep_name,
                    dep_version,
                )

        if missing or conflicting or parsing_probs:
            return ERROR
        else:
            write_output("No broken requirements found.")
            return SUCCESS
